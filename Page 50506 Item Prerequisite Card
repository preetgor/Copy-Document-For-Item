OBJECT Page 50506 Item Prerequisite Card
{
  OBJECT-PROPERTIES
  {
    Date=09/20/18;
    Time=12:00:00 PM;
    Modified=Yes;
    Version List=T02268;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Item Prerequisite Card;
               ENN=Item Prerequisite Card];
    SourceTable=Table27;
    PageType=Card;
    RefreshOnActivate=Yes;
    OnInit=BEGIN
             UnitCostEnable := TRUE;
             StandardCostEnable := TRUE;
             OverflowLevelEnable := TRUE;
             DampenerQtyEnable := TRUE;
             DampenerPeriodEnable := TRUE;
             LotAccumulationPeriodEnable := TRUE;
             ReschedulingPeriodEnable := TRUE;
             IncludeInventoryEnable := TRUE;
             OrderMultipleEnable := TRUE;
             MaximumOrderQtyEnable := TRUE;
             MinimumOrderQtyEnable := TRUE;
             MaximumInventoryEnable := TRUE;
             ReorderQtyEnable := TRUE;
             ReorderPointEnable := TRUE;
             SafetyStockQtyEnable := TRUE;
             SafetyLeadTimeEnable := TRUE;
             TimeBucketEnable := TRUE;
             ApprovalVisibilty_gBln := FALSE;
           END;

    OnOpenPage=VAR
                 CRMIntegrationManagement@1000 : Codeunit 5330;
                 InventorySetup_lRec@33027920 : Record 313;
               BEGIN
                 EnableShowStockOutWarning;
                 EnableShowShowEnforcePositivInventory;
                 CRMIntegrationEnabled := CRMIntegrationManagement.IsCRMIntegrationEnabled;

                 InventorySetup_lRec.GET;
                 InventorySetup_lRec.TESTFIELD("Enable Item Master Approval",TRUE);
                 ApprovalVisibilty_gBln := TRUE;
               END;

    OnAfterGetRecord=VAR
                       UserSetup_lRec@33027920 : Record 91;
                     BEGIN
                       EnablePlanningControls;
                       EnableCostingControls;
                       SetSocialListeningFactboxVisibility;
                     END;

    OnNewRecord=BEGIN
                  EnablePlanningControls;
                  EnableCostingControls;

                  "Prerequisite Item" := TRUE;
                  "Approval Status" := "Approval Status"::Open;
                  Blocked := TRUE;
                END;

    OnModifyRecord=BEGIN
                     TESTFIELD("Approval Status","Approval Status"::Open);
                   END;

    OnDeleteRecord=BEGIN
                     TESTFIELD("Approval Status","Approval Status"::Open);
                   END;

    OnAfterGetCurrRecord=VAR
                           CRMCouplingManagement@1001 : Codeunit 5331;
                         BEGIN
                           CRMIsCoupledToRecord := CRMIntegrationEnabled AND CRMCouplingManagement.IsRecordCoupledToCRM(RECORDID);
                           OpenApprovalEntriesExistCurrUser := ApprovalsMgmt.HasOpenApprovalEntriesForCurrentUser(RECORDID);
                           OpenApprovalEntriesExist := ApprovalsMgmt.HasOpenApprovalEntries(RECORDID);
                           ShowWorkflowStatus := CurrPage.WorkflowStatus.PAGE.SetFilterOnWorkflowRecord(RECORDID);
                         END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 123     ;1   ;ActionGroup;
                      CaptionML=[ENU=Master Data;
                                 ENN=Master Data];
                      Image=<DataEntry> }
      { 114     ;2   ;Action    ;
                      CaptionML=[ENU=&Units of Measure;
                                 ENN=&Units of Measure];
                      RunObject=Page 5404;
                      RunPageLink=Item No.=FIELD(No.);
                      Image=UnitOfMeasure }
      { 33027945;2   ;Action    ;
                      Name=<Action33029778>;
                      CaptionML=ENU=Copy Item;
                      Promoted=Yes;
                      Image=CopyDocument;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 CopyItem_gFnc;  //T02268-N
                               END;
                                }
      { 129     ;2   ;ActionGroup;
                      CaptionML=[ENU=Dimensions;
                                 ENN=Dimensions];
                      Image=Dimensions }
      { 184     ;2   ;Action    ;
                      ShortCutKey=Shift+Ctrl+D;
                      CaptionML=[ENU=Dimensions;
                                 ENN=Dimensions];
                      RunObject=Page 540;
                      RunPageLink=Table ID=CONST(27),
                                  No.=FIELD(No.);
                      Image=Dimensions }
      { 33027937;1   ;ActionGroup;
                      CaptionML=ENU=Item Approval;
                      Visible=ApprovalVisibilty_gBln;
                      Image=AnalysisView }
      { 33027936;2   ;ActionGroup;
                      CaptionML=ENU=Item Approval;
                      Visible=ApprovalVisibilty_gBln;
                      Image=AnalysisView }
      { 33027932;3   ;Action    ;
                      Name=Send Approval Request;
                      Promoted=Yes;
                      Visible=ApprovalVisibilty_gBln;
                      Image=SendApprovalRequest;
                      OnAction=VAR
                                 MasterApprovalManagement_lCdu@33027920 : Codeunit 33030034;
                               BEGIN
                                 MasterApprovalManagement_lCdu.Item_SendForApproval_gFnc(Rec);    //MasterApp-N
                               END;
                                }
      { 33027931;3   ;Action    ;
                      Name=Cancel Approval Re&quest;
                      Promoted=Yes;
                      Visible=ApprovalVisibilty_gBln;
                      Image=Cancel;
                      OnAction=VAR
                                 MasterApprovalManagement_lCdu@33027920 : Codeunit 33030034;
                               BEGIN
                                 MasterApprovalManagement_lCdu.Item_CancelApprovalRequest_gFnc(Rec);    //MasterApp-N
                               END;
                                }
      { 33027930;3   ;Action    ;
                      Name=Reopen Approval Entry;
                      CaptionML=[ENU=Reopen Approval Entry;
                                 ENN=Re&open];
                      Promoted=Yes;
                      Visible=ApprovalVisibilty_gBln;
                      Image=ReOpen;
                      OnAction=VAR
                                 MasterApprovalManagement_lCdu@33027920 : Codeunit 33030034;
                               BEGIN
                                 MasterApprovalManagement_lCdu.Item_ReOpenRequest_gFnc(Rec);    //MasterApp-N
                               END;
                                }
      { 33027929;3   ;Action    ;
                      CaptionML=ENU=Approval Entries;
                      Promoted=Yes;
                      Visible=ApprovalVisibilty_gBln;
                      Image=Approvals;
                      OnAction=VAR
                                 ItemMasterApprovalEntryAll_lPge@33027920 : Page 33030267;
                                 UserApprovalEntry_lRec@33027921 : Record 33029484;
                               BEGIN
                                 //MasterApp-NS  130618
                                 CLEAR(ItemMasterApprovalEntryAll_lPge);
                                 UserApprovalEntry_lRec.RESET;
                                 UserApprovalEntry_lRec.FILTERGROUP(2);
                                 UserApprovalEntry_lRec.SETRANGE("Document No.","No.");
                                 UserApprovalEntry_lRec.FILTERGROUP(0);
                                 ItemMasterApprovalEntryAll_lPge.SETTABLEVIEW(UserApprovalEntry_lRec);
                                 //ItemMasterApprovalEntryAll_lPge.LOOKUPMODE(TRUE);
                                 ItemMasterApprovalEntryAll_lPge.EDITABLE(FALSE);
                                 ItemMasterApprovalEntryAll_lPge.RUNMODAL;
                                 //MasterApp-NE  130618
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 33027933;1;Group    ;
                CaptionML=ENU=Basic Details;
                GroupType=Group }

    { 33027935;2;Field    ;
                SourceExpr="No.";
                Importance=Promoted;
                OnAssistEdit=BEGIN
                               IF AssistEdit THEN
                                 CurrPage.UPDATE;
                             END;
                              }

    { 33027926;2;Field    ;
                SourceExpr=Description;
                ShowMandatory=TRUE }

    { 33027934;2;Field    ;
                SourceExpr="Description 2" }

    { 1   ;1   ;Group     ;
                CaptionML=[ENU=General;
                           ENN=General] }

    { 6   ;2   ;Field     ;
                SourceExpr="Base Unit of Measure";
                Importance=Promoted;
                ShowMandatory=TRUE }

    { 170 ;2   ;Field     ;
                SourceExpr="Item Category Code";
                OnValidate=BEGIN
                             EnableCostingControls;
                           END;
                            }

    { 168 ;2   ;Field     ;
                SourceExpr="Product Group Code" }

    { 33027927;2;Field    ;
                SourceExpr=Principal }

    { 1905885101;1;Group  ;
                CaptionML=[ENU=Invoicing;
                           ENN=Invoicing] }

    { 1500002;2;Field     ;
                SourceExpr="GST Group Code" }

    { 1500003;2;Field     ;
                SourceExpr="GST Credit" }

    { 1500004;2;Field     ;
                SourceExpr="HSN/SAC Code" }

    { 33027920;2;Field    ;
                SourceExpr="Unit Price";
                Importance=Promoted }

    { 1904731401;1;Group  ;
                CaptionML=[ENU=Replenishment;
                           ENN=Replenishment] }

    { 133 ;2   ;Field     ;
                SourceExpr="Replenishment System";
                Importance=Promoted }

    { 54  ;2   ;Field     ;
                SourceExpr="Lead Time Calculation" }

    { 229 ;2   ;Group     ;
                CaptionML=[ENU=Purchase;
                           ENN=Purchase] }

    { 50  ;3   ;Field     ;
                SourceExpr="Vendor No." }

    { 52  ;3   ;Field     ;
                SourceExpr="Vendor Item No." }

    { 99  ;3   ;Field     ;
                SourceExpr="Purch. Unit of Measure" }

    { 230 ;2   ;Group     ;
                CaptionML=[ENU=Production;
                           ENN=Production] }

    { 227 ;3   ;Field     ;
                SourceExpr="Manufacturing Policy" }

    { 137 ;3   ;Field     ;
                SourceExpr="Routing No." }

    { 139 ;3   ;Field     ;
                SourceExpr="Production BOM No." }

    { 141 ;3   ;Field     ;
                SourceExpr="Rounding Precision" }

    { 143 ;3   ;Field     ;
                SourceExpr="Flushing Method" }

    { 13  ;2   ;Group     ;
                CaptionML=[ENU=Assembly;
                           ENN=Assembly];
                GroupType=Group }

    { 15  ;3   ;Field     ;
                SourceExpr="Assembly Policy" }

    { 1901343701;1;Group  ;
                CaptionML=[ENU=Planning;
                           ENN=Planning] }

    { 125 ;2   ;Field     ;
                SourceExpr="Reordering Policy";
                Importance=Promoted;
                OnValidate=BEGIN
                             EnablePlanningControls
                           END;
                            }

    { 1902697801;1;Group  ;
                CaptionML=[ENU=Tax Information;
                           ENN=Tax Information] }

    { 1500000;2;Group     ;
                CaptionML=[ENU=Sub Contracting;
                           ENN=Sub Contracting] }

    { 1500010;3;Field     ;
                SourceExpr=Subcontracting }

    { 1500011;3;Field     ;
                SourceExpr="Sub. Comp. Location" }

    { 33029234;1;Group    ;
                CaptionML=ENU=Quality Control;
                GroupType=Group }

    { 33029235;2;Field    ;
                Name=Item Specification Code;
                SourceExpr="Item Specification Code" }

    { 33029236;2;Field    ;
                SourceExpr="QC Required" }

    { 33029237;2;Field    ;
                SourceExpr="Sample %" }

    { 33029238;2;Field    ;
                SourceExpr="Entry for each Sample" }

    { 33027941;1;Group    ;
                CaptionML=ENU=Approval;
                Visible=ApprovalVisibilty_gBln;
                GroupType=Group }

    { 33027940;2;Field    ;
                SourceExpr="Approval Status" }

    { 33027928;2;Field    ;
                SourceExpr="Requester By" }

    { 33027942;2;Field    ;
                SourceExpr="Requested DateTime" }

    { 33027943;2;Field    ;
                SourceExpr="Approver By" }

    { 33027944;2;Field    ;
                SourceExpr="Approved Date Time" }

    { 33027939;2;Field    ;
                SourceExpr="Re-Open By" }

    { 33027938;2;Field    ;
                SourceExpr="Re-Open DateTime" }

    { 1900000007;0;Container;
                ContainerType=FactBoxArea }

    { 33027925;1;Part     ;
                SubPageLink=Source Type=CONST(Item),
                            Source No.=FIELD(No.);
                PagePartID=Page875;
                Visible=SocialListeningVisible;
                PartType=Page }

    { 33027924;1;Part     ;
                SubPageLink=Source Type=CONST(Item),
                            Source No.=FIELD(No.);
                PagePartID=Page876;
                Visible=SocialListeningSetupVisible;
                PartType=Page;
                UpdatePropagation=Both }

    { 33027923;1;Part     ;
                Name=WorkflowStatus;
                PagePartID=Page1528;
                Visible=ShowWorkflowStatus;
                Enabled=FALSE;
                Editable=FALSE;
                PartType=Page;
                ShowFilter=No }

    { 33027922;1;Part     ;
                Visible=TRUE;
                PartType=System;
                SystemPartID=RecordLinks }

    { 33027921;1;Part     ;
                Visible=TRUE;
                PartType=System;
                SystemPartID=Notes }

  }
  CODE
  {
    VAR
      SkilledResourceList@1001 : Page 6023;
      CalculateStdCost@1005 : Codeunit 5812;
      ItemAvailFormsMgt@1000 : Codeunit 353;
      ApprovalsMgmt@1013 : Codeunit 1535;
      ShowStockoutWarningDefaultYes@1006 : Boolean;
      ShowStockoutWarningDefaultNo@1004 : Boolean;
      ShowPreventNegInventoryDefaultYes@1003 : Boolean;
      ShowPreventNegInventoryDefaultNo@1002 : Boolean;
      TimeBucketEnable@19054765 : Boolean INDATASET;
      SafetyLeadTimeEnable@19079647 : Boolean INDATASET;
      SafetyStockQtyEnable@19036196 : Boolean INDATASET;
      ReorderPointEnable@19067744 : Boolean INDATASET;
      ReorderQtyEnable@19013534 : Boolean INDATASET;
      MaximumInventoryEnable@19059424 : Boolean INDATASET;
      MinimumOrderQtyEnable@19021857 : Boolean INDATASET;
      MaximumOrderQtyEnable@19007977 : Boolean INDATASET;
      OrderMultipleEnable@19004365 : Boolean INDATASET;
      IncludeInventoryEnable@19061544 : Boolean INDATASET;
      ReschedulingPeriodEnable@19049766 : Boolean INDATASET;
      LotAccumulationPeriodEnable@19019376 : Boolean INDATASET;
      DampenerPeriodEnable@19045210 : Boolean INDATASET;
      DampenerQtyEnable@19051814 : Boolean INDATASET;
      OverflowLevelEnable@19033283 : Boolean INDATASET;
      StandardCostEnable@19016419 : Boolean INDATASET;
      UnitCostEnable@19054429 : Boolean INDATASET;
      SocialListeningSetupVisible@1008 : Boolean INDATASET;
      SocialListeningVisible@1007 : Boolean INDATASET;
      CRMIntegrationEnabled@1010 : Boolean;
      CRMIsCoupledToRecord@1009 : Boolean;
      OpenApprovalEntriesExistCurrUser@1012 : Boolean;
      OpenApprovalEntriesExist@1011 : Boolean;
      ShowWorkflowStatus@1014 : Boolean;
      ApprovalVisibilty_gBln@33027920 : Boolean;

    LOCAL PROCEDURE EnableShowStockOutWarning@4();
    VAR
      SalesSetup@1000 : Record 311;
    BEGIN
      SalesSetup.GET;
      ShowStockoutWarningDefaultYes := SalesSetup."Stockout Warning";
      ShowStockoutWarningDefaultNo := NOT ShowStockoutWarningDefaultYes;
    END;

    LOCAL PROCEDURE EnableShowShowEnforcePositivInventory@2();
    VAR
      InventorySetup@1000 : Record 313;
    BEGIN
      InventorySetup.GET;
      ShowPreventNegInventoryDefaultYes := InventorySetup."Prevent Negative Inventory";
      ShowPreventNegInventoryDefaultNo := NOT ShowPreventNegInventoryDefaultYes;
    END;

    LOCAL PROCEDURE EnablePlanningControls@1();
    VAR
      PlanningGetParam@1000 : Codeunit 99000855;
      TimeBucketEnabled@1010 : Boolean;
      SafetyLeadTimeEnabled@1009 : Boolean;
      SafetyStockQtyEnabled@1008 : Boolean;
      ReorderPointEnabled@1007 : Boolean;
      ReorderQtyEnabled@1006 : Boolean;
      MaximumInventoryEnabled@1005 : Boolean;
      MinimumOrderQtyEnabled@1004 : Boolean;
      MaximumOrderQtyEnabled@1003 : Boolean;
      OrderMultipleEnabled@1002 : Boolean;
      IncludeInventoryEnabled@1001 : Boolean;
      ReschedulingPeriodEnabled@1015 : Boolean;
      LotAccumulationPeriodEnabled@1014 : Boolean;
      DampenerPeriodEnabled@1013 : Boolean;
      DampenerQtyEnabled@1012 : Boolean;
      OverflowLevelEnabled@1011 : Boolean;
    BEGIN
      PlanningGetParam.SetUpPlanningControls("Reordering Policy","Include Inventory",
        TimeBucketEnabled,SafetyLeadTimeEnabled,SafetyStockQtyEnabled,
        ReorderPointEnabled,ReorderQtyEnabled,MaximumInventoryEnabled,
        MinimumOrderQtyEnabled,MaximumOrderQtyEnabled,OrderMultipleEnabled,IncludeInventoryEnabled,
        ReschedulingPeriodEnabled,LotAccumulationPeriodEnabled,
        DampenerPeriodEnabled,DampenerQtyEnabled,OverflowLevelEnabled);

      TimeBucketEnable := TimeBucketEnabled;
      SafetyLeadTimeEnable := SafetyLeadTimeEnabled;
      SafetyStockQtyEnable := SafetyStockQtyEnabled;
      ReorderPointEnable := ReorderPointEnabled;
      ReorderQtyEnable := ReorderQtyEnabled;
      MaximumInventoryEnable := MaximumInventoryEnabled;
      MinimumOrderQtyEnable := MinimumOrderQtyEnabled;
      MaximumOrderQtyEnable := MaximumOrderQtyEnabled;
      OrderMultipleEnable := OrderMultipleEnabled;
      IncludeInventoryEnable := IncludeInventoryEnabled;
      ReschedulingPeriodEnable := ReschedulingPeriodEnabled;
      LotAccumulationPeriodEnable := LotAccumulationPeriodEnabled;
      DampenerPeriodEnable := DampenerPeriodEnabled;
      DampenerQtyEnable := DampenerQtyEnabled;
      OverflowLevelEnable := OverflowLevelEnabled;
    END;

    LOCAL PROCEDURE EnableCostingControls@3();
    BEGIN
      StandardCostEnable := "Costing Method" = "Costing Method"::Standard;
      UnitCostEnable := "Costing Method" <> "Costing Method"::Standard;
    END;

    LOCAL PROCEDURE SetSocialListeningFactboxVisibility@5();
    VAR
      SocialListeningMgt@1000 : Codeunit 871;
    BEGIN
      SocialListeningMgt.GetItemFactboxVisibility(Rec,SocialListeningSetupVisible,SocialListeningVisible);
    END;

    PROCEDURE CopyItem_gFnc@33029761();
    VAR
      ItemNo_lCod@33029763 : Code[20];
      IUM_lRec@33029762 : Record 5404;
      IUM2_lRec@33029761 : Record 5404;
      IUM3_lRec@33029760 : Record 5404;
      Item_lRec@33029764 : Record 27;
      Text33029767_lCtx@33029765 : TextConst 'ENU="Do you want to Copy data from other Item?    "';
    BEGIN
      //T02268-NS
      IF CONFIRM(Text33029767_lCtx,FALSE,TRUE) THEN BEGIN
        TESTFIELD("No.");
        ItemNo_lCod := "No.";
        IF PAGE.RUNMODAL(0,Item_lRec) = ACTION::LookupOK THEN BEGIN
          TRANSFERFIELDS(Item_lRec,FALSE);
          "No." := ItemNo_lCod;
          "Base Unit of Measure" := '';
          "Sales Unit of Measure" := '';
          "Purch. Unit of Measure" :='';
          //ContactEdit-NS
          "Created Date" := xRec."Created Date";
          "Created By" := xRec."Created By";
          //ContactEdit-NE
          VALIDATE("Unit Cost",0);
          Description := '';
          "Description 2" := '';
          "Approval Status" := "Approval Status"::Open;
          "Approved Date Time" := 0DT;
          "Requester By" := '';
          "Requested DateTime" := 0DT;
          "Re-Open By" := '';
          "Re-Open DateTime" := 0DT;
          "Approver By" := '';
          "Prerequisite Item" := TRUE;
          MODIFY;
          IUM_lRec.RESET;
          IUM_lRec.SETRANGE("Item No.",ItemNo_lCod);
          IF IUM_lRec.FINDSET THEN BEGIN
            IUM_lRec.DELETEALL(FALSE);
          END;
          IUM3_lRec.RESET;
          IUM3_lRec.SETRANGE("Item No.",Item_lRec."No.");
          IF IUM3_lRec.FINDSET THEN BEGIN
            REPEAT
              CLEAR(IUM2_lRec);
              IUM2_lRec.INIT;
              IUM2_lRec.TRANSFERFIELDS(IUM3_lRec,FALSE);
              IUM2_lRec."Item No." := ItemNo_lCod;
              IUM2_lRec.Code :=IUM3_lRec.Code;
              IUM2_lRec.INSERT(TRUE);
            UNTIL IUM3_lRec.NEXT = 0;
          END;
          VALIDATE("Base Unit of Measure",Item_lRec."Base Unit of Measure");

          MODIFY(TRUE);
        END
        ELSE
          EXIT;
      END;
      //T02268-NE
    END;

    BEGIN
    {
    Preet Gor
    T02268 : Add a Function - CopyItem_gFnc for Copy Document call it from New Action "CopyDocument".
    }
    END.
  }
}

